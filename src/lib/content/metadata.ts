// src/lib/content/metadata.ts
//
// OLX Metadata Schema - defines and validates metadata from YAML frontmatter comments
//
// Metadata is specified in the first comment before the root element using YAML frontmatter:
//
// <!--
// ---
// description: A brief description of this activity
// author: Content Creator Name
// tags:
//   - psychology
//   - assessment
// category: psychology
// ---
// -->
// <Vertical id="my_activity">
//   ...
// </Vertical>
//
// The schema uses Zod for validation and provides type-safe access to metadata fields.
//

import { z } from 'zod';

/**
 * Schema for OLX file metadata
 *
 * Currently supports:
 * - description: Brief text description of the activity/content
 */
// BCP 47 language tag validator using Intl API
const languageTagSchema = z.string().refine(
  (value) => {
    try {
      Intl.getCanonicalLocales(value);
      return true;
    } catch {
      return false;
    }
  },
  { message: "Invalid BCP 47 language tag" }
);

export const OLXMetadataSchema = z.object({
  description: z.string().optional(),
  category: z.string().optional(),
  lang: languageTagSchema.optional(),  // BCP 47 language tag (e.g., 'en-Latn-US', 'ar-Arab-SA')

  // Content provenance and generation status
  autogenerated: z.boolean().default(false),  // false = human-authored, true = auto-generated/translated
  source_file: z.string().optional(),     // Source file for auto-generated content (e.g., 'mult.olx')
  source_version: z.string().optional(),  // Source version hash for re-translation detection (e.g., 'a34a12')

  // Potential future fields - uncomment and implement as needed:

  // commitAuthor[s]: z.string().optional(),
  // contributors: z.array(z.object({
  //   name: z.string(),
  //   role: z.string().optional()
  // })).optional(),

  // tags: z.array(z.string()).optional(),
  // namespace: z.string().optional(),
  // modified: z.string().datetime().optional(),

  // This might be a link to the parent objects, a git hash, a
  // human-friendly version number, some combination, or something
  // else
  // version: z.string().optional(),
})

export type OLXMetadata = z.infer<typeof OLXMetadataSchema>;
